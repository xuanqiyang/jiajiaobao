!function(e,i){function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function n(n,t){if(!WebUploader.Uploader.support()){var l="上传控件不支持您的浏览器！请尝试升级flash版本或者使用Chrome引擎的浏览器。<a target='_blank' href='http://se.360.cn'>下载页面</a>";return i.console&&i.console.log(l),void e(n).text(l)}var s={auto:!0,hiddenInputId:"uploadifyHiddenInputId",onAllComplete:function(e){},onComplete:function(e){},innerOptions:{},fileNumLimit:void 0,fileSizeLimit:void 0,fileSingleSizeLimit:void 0,PostbackHold:!1},r=e.extend(s,t),u=e("#"+r.hiddenInputId),f=e(n),c="";c="undefined"!=typeof guidGenerator36?guidGenerator36():(65536*(1+Math.random())|0).toString(16).substring(1);var v='<div class="webuploader">';v=r.auto?'<div id="Uploadthelist" class="uploader-list"></div><div class="btns"><div id="'+c+'">选择文件</div></div>':'<div  class="uploader-list"></div><div class="btns"><div id="'+c+'">选择文件</div><button class="webuploadbtn">开始上传</button></div>',v+='<div style="display:none" class="UploadhiddenInput" >                         </div>',v+="</div>",f.append(v);var h=f.find(".uploader-list"),m=f.find(".webuploadbtn"),b="pending",g=f.find(".UploadhiddenInput"),w={fileList:[]},A=e.extend({swf:a+"/js/webuploader/Uploader.swf",server:"http://webuploader.duapp.com/server/fileupload.php",deleteServer:"/Home/DeleteFile",pick:"#"+c,resize:!1,fileNumLimit:r.fileNumLimit,fileSizeLimit:r.fileSizeLimit,fileSingleSizeLimit:r.fileSingleSizeLimit,accept:r.accept},r.innerOptions);alert(A.accept.mimeTypes);var I=WebUploader.create(A),S=u.val();S&&r.PostbackHold&&(w=JSON.parse(S),e.each(w.fileList,function(e,i){var n=d();i.queueId=n,h.append('<div id="'+n+'" class="item"><div class="info">'+i.name+'</div><div class="state">已上传</div><div class="del"></div></div>')}),u.val(JSON.stringify(w))),r.auto?I.on("fileQueued",function(i){var d=e('<div id="'+i.id+'" class="file-item thumbnail"><img><div class="info">'+i.name+"</div></div>"),n=d.find("img");h.append(d),I.makeThumb(i,function(e,i){e?n.replaceWith("<span>不能预览</span>"):n.attr("src",i)},o,p),I.upload()}):I.on("fileQueued",function(i){h.append('<div id="'+e(n)[0].id+i.id+'" class="item"><span class="webuploadinfo">'+i.name+'</span><span class="webuploadstate">等待上传...</span><div class="webuploadDelbtn">删除</div><br /></div>')}),I.on("uploadProgress",function(i,d){var a=f.find("#"+e(n)[0].id+i.id),t=a.find(".progress .bar");t.length||(t=e('<span class="progress"><span  class="percentage"><span class="text"></span><span class="bar" role="progressbar" style="width: 0%"></span></span></span>').appendTo(a).find(".bar")),a.find("span.webuploadstate").html("上传中"),a.find(".text").text(Math.round(100*d)+"%"),t.css("width",100*d+"%")}),I.on("uploadSuccess",function(i,d){"error"==d.state?f.find("#"+e(n)[0].id+i.id).find("span.webuploadstate").html(d.message):(f.find("#"+e(n)[0].id+i.id).find("span.webuploadstate").html("已上传"),g.append('<input type="text" id="hiddenInput'+e(n)[0].id+i.id+'" class="hiddenInput" value="'+d.message+'" />'))}),I.on("uploadError",function(i){f.find("#"+e(n)[0].id+i.id).find("span.webuploadstate").html("上传出错")}),I.on("uploadComplete",function(i){f.find("#"+e(n)[0].id+i.id).find(".progress").fadeOut()}),I.on("all",function(e){"startUpload"===e?b="uploading":"stopUpload"===e?b="paused":"uploadFinished"===e&&(b="done"),"uploading"===b?m.text("暂停上传"):m.text("开始上传")}),I.on("fileDequeued",function(i){var d=e("#hiddenInput"+e(n)[0].id+i.id).val();null!=d&&e.post(A.deleteServer,{fullName:d},function(e){alert(e.message)}),e("#"+e(n)[0].id+i.id).remove(),e("#hiddenInput"+e(n)[0].id+i.id).remove()}),m.on("click",function(){"uploading"===b?I.stop():I.upload()}),h.on("click",".webuploadDelbtn",function(){var i=(i=e(this).parent().attr("id")).replace(e(n)[0].id,""),d=I.getFile(i);I.removeFile(d)})}var a=""===i.applicationPath?"":i.applicationPath||"../..",t=e("#uploader"),l=(e('<ul class="filelist"></ul>').appendTo(t.find(".queueList")),t.find(".statusBar")),s=(l.find(".info"),t.find(".uploadBtn"),t.find(".placeholder"),l.find(".progress").hide(),i.devicePixelRatio||1),o=110*s,p=110*s;!function(){var e=new Image,i=!0;e.onload=e.onerror=function(){1==this.width&&1==this.height||(i=!1)},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}();e.fn.GetFilesAddress=function(i){var d=[];return e(this).find(".UploadhiddenInput").find(".hiddenInput").each(function(){d.push(e(this).val())}),d},e.fn.powerWebUpload=function(i){var d=this;if("undefined"==typeof WebUploader){var t=a+"/js/webuploader/webuploader.css";e("<link>").attr({rel:"stylesheet",type:"text/css",href:t}).appendTo("head");var l=a+"/js/webuploader/webuploader.js";e.getScript(l).done(function(){n(d,i)}).fail(function(){alert("请检查webuploader的路径是否正确!")})}else n(d,i)}}(jQuery,window);